{{ define "main" }}
<main class="container mx-auto px-4 py-8">

  {{/* Define groups (order you want shown). 
      Keys must match either .Params.status or mapped pub types below. */}}
  {{ $groups := slice
    (dict "key" "Published Articles" "title" "Published Articles")
    (dict "key" "Working Papers" "title" "Working Papers")
    (dict "key" "Work in Progress" "title" "Work in Progress")
  }}

  {{/* Map publication_types -> human labels (fallback) */}}
  {{ $ptype := dict "2" "Published Articles" "3" "Working Papers" "4" "Work in Progress" }}

  {{/* Build a map: groupKey => pages */}}
  {{ $bucket := dict }}
  {{ range .Pages }}
    {{/* Prefer explicit status; else map from first publication_type; else "Work in Progress" */}}
    {{ $status := .Params.status }}
    {{ if not $status }}
      {{ $t := "" }}
      {{ with .Params.publication_types }}
        {{ $t = index . 0 }}
      {{ end }}
      {{ $status = or (index $ptype $t) "Work in Progress" }}
    {{ end }}
    {{ $cur := slice }}
    {{ with index $bucket $status }}
      {{ $cur = . }}
    {{ end }}
    {{ $bucket = merge $bucket (dict $status (uniq (append $cur .))) }}
  {{ end }}

  {{/* Render in desired order */}}
  {{ range $groups }}
    {{ $items := index $bucket .key }}
    {{ if gt (len $items) 0 }}
      <h2 class="text-3xl font-semibold mt-12 mb-6">{{ .title }}</h2>
      {{ range sort $items "Date" "desc" }}
        {{ .Render "summary" }}
      {{ end }}
    {{ end }}
  {{ end }}

</main>
{{ end }}
